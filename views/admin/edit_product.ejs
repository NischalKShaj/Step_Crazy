<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Step-Crazy/Edit_Product</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.2/css/bootstrap-utilities.rtl.min.css"
      integrity="sha512-g/9zc34RrAHk9cSFEodVsDR+TjDAhw9+VjWHnbK6kZe6sK4xTpPJ6cqJYd3WXfFmQuNLIkhDetQdm6fOOzj/nQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
      integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>
  <body>
    <div class="container mt-4">
      <div class="row">
        <div class="col-lg-12" mx-auto mt-4>
          <div class="card shadow">
            <div class="card-header bg-danger">
              <h3 class="text-light">Edit Product</h3>
              <h2 class="text-light"><%= product.name %></h2>
            </div>
            <div class="card-body p-4">
              <form
                action="/admin/dashboard/product/update/<%= product._id %>"
                method="post"
                id="add-form"
                enctype="multipart/form-data"
              >
                <div class="form-outline mb-2">
                  <label for="name">Name</label>
                  <input
                    value="<%= product.name %>"
                    type="text"
                    name="name"
                    class="form-control form-control-lg"
                    placeholder="Enter the name of the product"
                    required
                  />
                </div>
                <div class="form-outline mb-2">
                  <label for="description">Description</label>
                  <textarea
                    class="form-control form-control-lg"
                    id="description"
                    name="description"
                    rows="4"
                    placeholder="Enter product description"
                    required
                  >
<%= product.description %></textarea
                  >
                </div>
                <div class="form-outline mb-2">
                  <label for="price">Price</label>
                  <input
                    min="1"
                    value="<%= product.price%>"
                    type="number"
                    name="price"
                    class="form-control form-control-lg"
                    placeholder="Enter the price of the product"
                    required
                  />
                </div>
                <div class="form-outline mb-2">
                  <label for="stock">Stock</label>
                  <input
                    min="1"
                    value="<%= product.stock %>"
                    type="number"
                    name="stock"
                    class="form-control form-control-lg"
                    placeholder="Enter the number of products available"
                    required
                  />
                </div>
                <div class="form-outline mb-2">
                  <label for="category" class="form-label">Category</label>
                  <select
                    name="category"
                    id="Kategori"
                    class="ms-1 d-block w-100"
                    required
                  >
                    <option value="<%= product.category %>">
                      <%= product.category %>
                    </option>
                    <% category.forEach((row) => { %>
                    <option value="<%= row.category %>"><%= row.category %></option>
                    <% }); %>
                  </select>
                </div>
                <div class="form-outline mb-2">
                  <label for="image">Select Image</label>
                  <input
                    multiple
                    accept="image/*"
                    type="file"
                    name="image"
                    class="form-control form-control-lg"
                  />
                </div>

                <div style="display: flex; margin-top: 20px">
                  <% product.image.forEach(element => { %>
                  <div style="position: relative">
                    <img
                      class="img-fluid"
                      style="width: 90px; margin: 10px"
                      src="/<%= element %>"
                      alt=""
                    />
                    <a
                     
                      style="position: absolute; top: 0; right: 0; color: red"
                      class="fas fa-times "
                      href="/admin/dashboard/product/delete/<%= element %>/<%= product._id %>"
                    ></a>
                  </div>
                  <% }) %>
                </div>

                <button type="submit" class="btn btn-success">
                  Update product
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      src =
        "https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.2/js/bootstrap.bundle.min.js";
      integrity =
        "sha512-X/YkDZyjTf4wyc2Vy16YGCPHwAY8rZJY+POgokZjQB2mhIRFJCckEGc6YyX9eNsPfn0PzThEuNs+uaomE5CO6A==";
      crossorigin = "anonymous";
      referrerpolicy = "no-referrer";
    </script>
    <script>
      const deleteProduct = document.querySelectorAll(".deleteProduct")

      deleteProduct.forEach((deleteProd)=>{
        deleteProd.addEventListener("click", function(e){
          e.preventDefault()

          const ProductId = this.id.split("_")[1];
          const confirmation = confirm("Are you sure you want to delete this image")

          if(confirmation){
            fetch(`/admin/dashboard/product/delete/${ProductId}`,{
              method : "delete",
            })
            .then((response)=>{
              if(response.ok){
                this.parentNode.parentNode.remove();
              } else {

                console.log("Error occured while deleting..");
              }
            })
            .catch((error)=>{
              console.error("Network error",error);
            })
          }
        })
      })
    </script>
  </body>
</html>
